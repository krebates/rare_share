= render partial: "communities/modals/new_discussion"
.margin--small--bottom
  = link_to I18n.t("discussion.new"), "#new_discussion", { data: { target: '#new_discussion', toggle: 'modal' }, class: 'btn btn-primary' }
- if @community.discussions.present?
  .row
    - @community.discussions.order('updated_at DESC').each do |discussion|
      .col-md-1
        - author_image = discussion.author.avatar.present? ? discussion.author.avatar : 'community-icon.png'
        = image_tag author_image, class: 'icon-image--rounded'
      .col-md-11
        %strong
          = link_to "#{discussion.title}", discussion_path(discussion)
        %i
          = "Created by #{discussion.author.name}"
        %br
          %small
            = "Last updated #{time_ago_in_words(discussion.last_updated)} ago"
        %br
        - if discussion.posts.present?
          .row.margin--small--top
            - discussion.newest_posts.take(3).each do |post|
              .col-md-1
                - author_image = post.author.avatar.present? ? post.author.avatar : 'community-icon.png'
                = image_tag author_image, class: 'icon-image--rounded'
              .col-md-11
                %i
                  = I18n.t("homepage.discussion.posted")
                  = link_to post.author.name, profile_path(post.author)
                %br
                %i
                  %small
                    = "#{time_ago_in_words(post.created_at)} ago"
                %p
                  = post.body.html_safe
        = render partial: 'shared/view_full_thread', locals: { discussion: discussion }

- else
  = render partial: 'discussions/blank_state', locals: { community: @community }
